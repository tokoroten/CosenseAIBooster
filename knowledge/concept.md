# CosenseAIBoosterの設計と仕様

## プロジェクト概要

CosenseAIBooster（コセンスAIブースター）は、Cosense（旧Scrapbox）ユーザー向けのChrome拡張機能です。音声入力とAI支援機能を通じて、Cosenseでの文書作成と編集を強化します。

対象サービス: 
- Cosense: https://cosen.se/
- Scrapbox: https://scrapbox.io/

## 主要機能

### 設定システム
- React + Zustandベースの設定UI
- 複数の設定タブ（プロンプト、API設定、一般設定）
- 設定データの永続化（Chrome Storage API使用）
- 設定間のリアルタイム同期

### Cosense UI拡張
- カスタムDOM操作ユーティリティ（react-cosense-dom.ts）
- ページ上部メニューへのマイクボタン追加
- テキスト選択時のポップアップメニューにAIプロンプトボタンを追加
- Reactコンポーネントでのダイアログ表示システム

### リアルタイム音声認識
- WebSpeech APIを使用したブラウザネイティブ音声認識
- リアルタイム認識結果のオーバーレイ表示
- 複数言語対応（ja-JP, en-US, など）
- エラーハンドリングと権限管理
  - マイク権限エラー時のユーザーフレンドリーな通知
  - 認識失敗時のリトライ機能

### AIプロンプト処理
- カスタマイズ可能なプロンプトシステム
  - プロンプトの作成、編集、削除機能
  - デフォルトプロンプトのプリセット
  - プロンプト毎のモデル設定
- OpenAIとOpenRouter APIに対応
  - GPT-3.5、GPT-4o、Claude、Geminなど多様なモデル
  - APIキー管理とバリデーション
- テキスト挿入位置の制御
  - 選択範囲直下（below）または文書末尾（bottom）
  - 自動改行・整形オプション

## アーキテクチャ

### フロントエンド (コンテンツスクリプト)
- React + Zustandベースのコンポーネントシステム
- TailwindCSSによるスタイリング
- Web Speech APIインテグレーション

### バックエンド (バックグラウンドスクリプト)
- APIリクエスト処理
- セキュアなキー管理
- データ永続化（Chrome Storage API）

## ビルド・デプロイ
- WXT (WebExtension Tools)による拡張機能開発
- Viteによる高速ビルド
- ESLintとPrettierによるコード品質管理
- GitHub Actionsによる自動ビルド・リリース

## セキュリティ設計

### APIキーの保護
- APIキーはバックグラウンドスクリプト内でのみアクセス可能
- コンテンツスクリプトにはAPIキーを露出させない設計
- メッセージパッシングによる安全な要求/応答モデル

### ストレージセキュリティ
- Chrome Storage API (local)を使用して設定を永続化
- センシティブデータへのアクセス制御
- 適切なエラーハンドリングとデータバリデーション

## CI/CD パイプライン

### 自動ビルド・リリース
- GitHub Actionsによるワークフロー自動化
- タグプッシュ（v*形式）をトリガーとした自動ビルド
- パッケージング（ZIPファイル生成）
- GitHub Releasesへの自動公開

### バージョン管理
- package.jsonでの一元的なバージョン管理
- GitフロータグとGitHub Releases連携
- リリースノート自動生成

## 使用例

### 音声入力を活用したノート作成
1. Cosenseページで音声入力ボタン（マイクアイコン）をクリック
2. 音声で内容を入力（「今日のミーティングで話し合った主要なポイントは...」）
3. 認識結果がリアルタイムで表示され、確定後にカーソル位置に挿入
4. 必要に応じて「音声認識成形」プロンプトで整形

### AIによる文章要約
1. 要約したいテキストを選択
2. ポップアップメニューから「要約」プロンプトを選択
3. AIが処理を実行し、結果を選択テキストの直下に挿入
4. 必要に応じて結果を編集

### 知識拡張と事実確認
1. 調査したいトピックについて書かれたテキストを選択
2. 「知識（日本語）」または「ファクトチェック」プロンプトを適用
3. AIが追加情報や出典付きの事実確認結果を提供
4. Cosenseページ内で知識を拡張

## 将来の展望

### 短期的な改善計画（2025年後半）
- プロンプトごとのカスタム設定の拡充
  - 各プロンプトごとの詳細なモデルパラメータ設定
  - 結果のフォーマット指定オプション
- UIの拡張
  - プロンプトのカテゴリ分け機能
  - ドラッグ&ドロップによる順序変更
- パフォーマンス最適化
  - キャッシュ機構の導入
  - 大規模ページでの応答性向上

### 中長期的なビジョン（2026年以降）
- マルチモーダル対応
  - 画像認識と処理機能の追加
  - 図表生成機能
- チーム向け機能
  - 共有プロンプトライブラリ
  - チーム設定の同期
- オフライン機能
  - 一部機能のローカル実行オプション
  - データキャッシュの強化

